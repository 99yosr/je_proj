generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Activite {
  id          Int    @id @default(autoincrement())
  nom         String
  description String
  juniorId    Int
  Junior      Junior @relation(fields: [juniorId], references: [id])
}

model Event {
  id                    Int        @id @default(autoincrement())
  title                 String
  slug                  String     @unique
  shortDescription      String
  fullDescription       String
  date                  DateTime?
  location              String?
  isActive              Boolean    @default(true)
  createdAt             DateTime   @default(now())
  updatedAt             DateTime   @updatedAt
  juniorId              Int
  createdById           String
  featuredMediaData     Bytes?
  featuredMediaMimeType String?
  logoData              Bytes?
  logoMimeType          String?
  User                  User       @relation(fields: [createdById], references: [id])
  Junior                Junior     @relation(fields: [juniorId], references: [id])
  Feedback              Feedback[]

  @@index([updatedAt])
  @@index([juniorId])
  @@index([isActive])
}

model Feedback {
  id        Int      @id @default(autoincrement())
  contenu   String
  note      Int
  projectId Int?
  createdAt DateTime @default(now())
  updatedAt DateTime
  eventId   Int?
  Event     Event?   @relation(fields: [eventId], references: [id], onDelete: Cascade)
  Project   Project? @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model FicheJE {
  nomJE       String
  description String
  contact     String
  juniorId    Int      @unique
  createdAt   DateTime @default(now())
  Junior      Junior   @relation(fields: [juniorId], references: [id])
}

model Junior {
  id            Int        @id @default(autoincrement())
  created_at    DateTime   @default(now())
  name          String
  role          String
  city          String
  contact_email String?
  Activite      Activite[]
  Event         Event[]
  FicheJE       FicheJE?
  Project       Project[]
}

model Message {
  id                            Int      @id @default(autoincrement())
  content                       String
  isRead                        Boolean  @default(false)
  createdAt                     DateTime @default(now())
  senderId                      String
  receiverId                    String
  User_Message_receiverIdToUser User     @relation("Message_receiverIdToUser", fields: [receiverId], references: [id], onDelete: Cascade)
  User_Message_senderIdToUser   User     @relation("Message_senderIdToUser", fields: [senderId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([receiverId])
  @@index([senderId])
}

model News {
  id        Int      @id @default(autoincrement())
  title     String
  content   String
  image     String?
  createdAt DateTime @default(now())
  updatedAt DateTime
  author    String?
}

model Project {
  id          Int        @id @default(autoincrement())
  titre       String
  description String
  statut      String     @default("EN_ATTENTE")
  dateDebut   DateTime?
  dateFin     DateTime
  createdAt   DateTime   @default(now())
  updatedAt   DateTime
  juniorId    Int
  revenu      Float?
  Feedback    Feedback[]
  Junior      Junior     @relation(fields: [juniorId], references: [id])
}

model User {
  id                               String    @id @default(cuid())
  email                            String    @unique
  name                             String
  createdAt                        DateTime  @default(now())
  password                         String
  role                             Role      @default(RJE)
  nbrmembres                       Int?      @default(0)
  Event                            Event[]
  Message_Message_receiverIdToUser Message[] @relation("Message_receiverIdToUser")
  Message_Message_senderIdToUser   Message[] @relation("Message_senderIdToUser")
}

enum Role {
  RJE
  ADMIN
}
